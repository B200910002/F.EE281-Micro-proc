#include <avr/io.h>
#define F_CPU 16000000UL
#define __DELAY_BACKWARD_COMPATIBLE__
#include <util/delay.h>
void buzzer(int hz, int count);
int main(void)
{
	/*{1047,1175,1319,1397,1568,1760,1976,2093};*/
	/*{131,147,165,175,196,220,247,262}*/
	/*{262,294,330,350,392,440,454,524}*/
	// 	int i,hertz[]={1319,1175,1319,1175,1319,2093,1175,1047,1976,1047,1319,1976, 2093,1319,1760,2093,1047,
	 //		1319,1319,1175,1319,1175,1319,2093,1175,1047,1976,1047,1319,1976,2093,1319,1047,2093,1976,1319,1175,
	 //		1976,2093,1047,1175,1319,1760,1397,1319,1175,1397,1319,1175,
	 //		1047,1319,1175,1047,2093,1319,1319,1319,1319,1319,1319,1175,1319,1175,
	 //		1319,1175,1319,1175,1319,1175,1319,1175};
	 
	int i,hertz[]={
					330*4,311*4,330*4,311*4,330*4,247*4,294*4,262*4,220*4,174*4,175*4,220*4,247*4,175*4,233*4,247*4,262*4,330*4,311*4,330*4,311*4,330*4,247*4,294*4,262*4,220*4,147*4,
					175*4,220*4,247*4,175*4,262*4,247*4,220*4,247*4,262*4,294*4,330*4,196*4,350*4,330*4,294*4,165*4,330*4,294*4,262*4,147*4,294*4,262*4,247*4,330*4,311*4,330*4,311*4,330*4,247*4,
					294*4,262*4,220*4,147*4,175*4,220*4,247*4,175*4,233*4,247*4,262*4,330*4,311*4,330*4,311*4,330*4,247*4,294*4,262*4,220*4,147*4,175*4,220*4,247*4,175*4,262*4,247*4,220*4,
					330*4,330*4,330*4,330*4,330*4,311*4,330*4};
	// do re mi fa sol la ci do ??????????
	// 	int loop[]={165,147,165,147,165,262,147,131,494,262,165,247, 523,330,220,262,1047,330,165,147,165,
	// 		147,165,262,147,131,494,131,165,247,523,330,131,262,494,165,147,
	// 		494,524,131,147,330,440,175,165,294,350,165,147,
	// 		262,330,147,131,524,330,83,165,83,83,83,147,165,147,
	// 		165,147,165,147,165,147,165,147};
	
	int loop[]={
				330,311,330,311,330,247,294,262,220,174,175,220,247,
				175,233,247,262,330,311,330,311,330,247,294,262,220,
				147,175,220,247,175,262,247,220,247,262,294,330,196,
				350,330,294,165,330,294,262,147,294,262,247,330,311,
				330,311,330,247,294,262,220,147,175,220,247,175,233,
				247,262,330,311,330,311,330,247,294,262,220,147,175,
				220,247,175,262,247,220,330,330,330,330,330,311,330
				};
	// fur elise
	char LED[]={
				//0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,
				//0x00,0xff,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0x00,0xff,0x00,0xff,0x00,0xff,0x00,
				//0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0xff,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,
				0x10, 0x08,0x10,0x08,0x10,0x02,0x08,0x04,0x01, 0x04, 0x10,0x01,0x02,0x10,0x01,0x02,0x04,0x10, 0x08,0x10,0x08,0x10,0x02,0x08,0x04,
				0x01, 0x04, 0x10,0x01,0x02,0x10,0x01,0x02,0x04,0x02,0x04,0x08,0x10,0x40,0x20,0x10,0x08,0x10,0x10,0x08,0x04,0x10,0x08,0x04,0x10,
				0x10, 0x08,0x10,0x08,0x10,0x02,0x08,0x04,0x01, 0x04, 0x10,0x01,0x02,0x10,0x01,0x02,0x04,0x10, 0x08,0x10,0x08,0x10,0x02,0x08,0x04,
				0x01, 0x04, 0x10,0x01,0x02,0x10,0x01,0x02,0x04,0x10,0x10,0x10,0x10,0x10,0x08,0x10
				};
	// 
	DDRA |=0xff; // A ???? LED
	DDRB |=0x10; // B4 ???? BUZZER
	while (1)
	{
		for (i=0; i<90; i++)
		{
			PORTA=LED[i]; // LED-? ?? ????????.
			buzzer(hertz[i],loop[i]); // 1 ??? ?????? ??? ???????.
			
		}
		_delay_ms(100); // ??? ?????? ????? 1 ?????? ??????
	}
}
void buzzer(int hz, int count) // Hz ???????, ?????? ???? ????
{
	int i, millis, micros;
	millis=1000/(hz*2); // ????????? ???????? ms -? ????
	micros=(1000.0/(hz*2)-millis)*1000; // ????????? ???????? us -? ????
	for (i=0;i<count;i++)
	{
		PORTB |=1<<4; // ?????? ON
		_delay_us(millis); // ms ??????????
		_delay_us(micros); // us ??????????
		PORTB &=~(1<<4); // ?????? OFF
		_delay_us(millis); // ms ??????????
		_delay_us(micros); // us ??????????
	}
}